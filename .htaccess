# =========================================
# üåê .HTACCESS UNIVERSAL - CuVaRents MVC
# Compatible con localhost y producci√≥n (Hostinger)
# =========================================

<IfModule mod_headers.c>
    Header set Access-Control-Allow-Origin "*"
</IfModule>

Options -Indexes

<FilesMatch "\.(env|ini|log|sql)$">
    Require all denied
</FilesMatch>

# --- P√°ginas de error personalizadas (controladas por el MVC) ---
ErrorDocument 404 /index.php?url=error/404
ErrorDocument 403 /index.php?url=error/403
ErrorDocument 500 /index.php?url=error/500

# ===============================================================
# üöÄ MOTOR DE REESCRITURA
# ===============================================================
<IfModule mod_rewrite.c>
    RewriteEngine On

    # ===============================
    # üîß Ajuste autom√°tico de BASE
    # ===============================

    # Si est√°s en localhost (carpeta /cuvarents)
    RewriteCond %{HTTP_HOST} ^localhost [NC]
    RewriteRule ^ - [E=BASE:/cuvarents/]

    # Si est√°s en producci√≥n (cuvarents.com)
    RewriteCond %{HTTP_HOST} !^localhost [NC]
    RewriteRule ^ - [E=BASE:/]

    # ‚úÖ Base correcta para local (subcarpeta /cuvarents/)
    RewriteBase /cuvarents/

    # ===============================================================
    # üö´ EXCEPCIONES: No reescribir rutas API o archivos reales
    # ===============================================================

    # ‚öôÔ∏è Dejar pasar llamadas a /api/
    RewriteCond %{REQUEST_URI} ^/cuvarents/api/ [NC]
    RewriteRule ^ - [L]

    # ‚öôÔ∏è Archivos est√°ticos
    RewriteCond %{REQUEST_URI} ^/cuvarents/assets/ [NC]
    RewriteRule ^ - [L]

    RewriteCond %{REQUEST_URI} ^/cuvarents/uploads/ [NC]
    RewriteRule ^ - [L]

    # ===============================================================
    # ‚öôÔ∏è RUTEO MVC GENERAL
    # ===============================================================
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ %{ENV:BASE}index.php?url=$1 [QSA,L]
</IfModule>
